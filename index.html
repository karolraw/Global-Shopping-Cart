<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Shopping Cart</title>
    <script>

    let shoppingItems = JSON.parse(window.localStorage.getItem("shoppingItems")) || []

        function totalCost() {
            let totalCost = 0
            for (let index = 0; index < shoppingItems.length; index++) {
                let shoppingItem = shoppingItems[index]
                let price = shoppingItem.price
                totalCost += price
            }

            let budget = document.getElementById("budget").value

            if (totalCost < budget) {
                return `${totalCost.toFixed(2)} zł`
            } else {
                alert(`Total cost is ${totalCost.toFixed(2)} zł.\nBudget exceeded by ${(totalCost - budget).toFixed(2)} zł!`)
            }

        }

        function createRows() {
            const tableBody = document.getElementById("tableBody")

            tableBody.innerHTML = ""
        
            let shoppingItems = JSON.parse(window.localStorage.getItem("shoppingItems"))
            if (!shoppingItems) {
                return
            } 

            for (let index = 0; index < shoppingItems.length; index++) {
                const row = document.createElement("tr")
                let shoppingItem = shoppingItems[index]

                row.innerHTML = `<td>${shoppingItem.description}</td>
                                <td>${shoppingItem.store}</td>
                                <td>${shoppingItem.price.toFixed(2)} zł</td>
                                <td>${shoppingItem.category}</td>
                                <td><a href=${shoppingItem.website} target="_blank">Visit Store</a></td>
                                <td><button onclick='document.getElementById("preview").src = "${shoppingItem.previewImage}"'>preview</button></td>
                                `
                tableBody.appendChild(row)
            }
        }

        function addShoppingItem() {
            let shoppingItem = {}

            shoppingItem.description = document.getElementById("description").value
            shoppingItem.store = document.getElementById("store").value
            shoppingItem.price = Number(document.getElementById("price").value)
            shoppingItem.category = document.getElementById("category").value
            shoppingItem.website = document.getElementById("website").value
            shoppingItem.previewImage = document.getElementById("previewImage").value

            shoppingItems.push(shoppingItem)
            window.localStorage.setItem("shoppingItems", JSON.stringify(shoppingItems))
            createRows() // Refresh the table

            document.getElementById("description").value = null
            document.getElementById("store").value = null
            document.getElementById("price").value = null
            document.getElementById("category").value = null
            document.getElementById("website").value = null
            document.getElementById("previewImage").value = null
        } 

        function clearStorage() {
            window.localStorage.clear()
            shoppingItems = []
            createRows()
        }

    </script>  
</head>
<body onload="createRows()">

    <div style="margin-top: 100px; display: flex; align-items: center; justify-content: center;">
        <button onclick="document.getElementById('totalCost').textContent = totalCost()" style="margin: 10px;">Calculate Total Cost</button>
        <span id="totalCost"></span>
    </div>

    <div style="display: flex; align-items: center; justify-content: center;">
        <label for="budget" style="margin:0 10px">Budget:</label>
        <input id="budget" size="5" value="2000">
        <label for="budget" style="margin:0 10px">zł</label>
    </div>

    <div>
        <form autocomplete="off">
            <label for="description">Description:</label>
            <input id="description"><br>

            <label for="store">Store:</label>
            <input id="store"><br>

            <label for="price">Price:</label>
            <input id="price"><br>

            <label for="website">Website:</label>
            <input id="website"><br>

            <label for="category">Category:</label>
            <input id="category"><br>

            <label for="previewImage">Preview Image:</label>
            <input id="previewImage"><br>

            <input type="button" onclick="addShoppingItem()" value="Add Item">
            <input type="button" onclick="clearStorage()" value="Clear Storage">
        </form>
    </div>

    <div style="display: flex; align-items: center; justify-content: space-between;">
        <table style="margin-left: 200px;">
            <thead>
                <tr>
                    <th>Description</th>
                    <th>Store</th>
                    <th>Price</th>
                    <th>Category</th>
                    <th>Website</th>
                    <th>Preview</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                <!-- create body using script -->
            </tbody>
        </table>
        
        <img id="preview" src="" alt="Select Item to Preview" style="height: 300px; width: auto; margin-right: 200px;">
    </div>

</body>
</html>