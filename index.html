<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Shopping Cart</title>
    <style>

        .modal {
            display: none;
            background-color: rgba(0, 0, 0, 0.5);
            position: fixed;
            top: 0; left: 0;
            width: 100vw;
            height: 100vh;
            align-items: center;
            justify-content: center;
            z-index: 1;
        }

        .form-container {
            background-color: aqua;
            padding: 10px;
            border-radius: 8px;
        }

        form label, form input, select {
            margin: 5px 0;
        }

        .container {
            display:flex;
            background-color: #5dd0d8;
            border-radius: 8px;
        }

        .table-container {
            margin: 10px;
            height: 300px;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            flex-grow: 1;
            overflow-y: auto;
        }
        
        .image-container {   
            margin: 10px;
            width: 300px;
            height: 300px; 
            display: flex;
            align-items: center;
            justify-content: center;
        }

        img {
            width: 200px;
            height: auto;
            border-radius: 8px;
        }

        th, td {
            border: 1px solid black;
            border-radius: 4px;
            padding: 3px;
        }

        th {
            background-color: aquamarine;
            position: sticky;
            top: 0;
        }
        
        td:nth-child(5), td:nth-child(6) {
            text-align: center;
        }
        td:nth-child(8), td:nth-child(9) {
            border: none;
            background-color: #5dd0d8;
        }

        td:nth-child(8) button, td:nth-child(9) button {
            background-color: #ee82ee;
            border-radius: 4px;
            font-weight: bold;
        }
        
        td:nth-child(8) button:hover, td:nth-child(9) button:hover {
            background-color: lightpink;
        }

        tr {
            background-color: lightcyan;
        }

        tr:hover {
            background-color: rgb(133, 255, 255);
        }

        a {
            text-decoration: none;
        }

        
    </style> 
</head>
<body onload="createRows()">

    <div style="background-color: darkblue; border-radius: 8px; height: 50px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
        <div style="margin-left: 10px;">
            <button onclick="clearStorage()" style="background-color: orange;">Clear Storage</button>
        </div>

        <div>
            <h1 style="color:greenyellow;">Global Shopping Cart</h1>
        </div>
        
        <div style="margin-right: 10px;">
            <button onclick="document.getElementById('modal-add-item').style.display = 'flex'" style="background-color: orange;">New Item</button>
        </div>
    </div>

    <div class="modal" id="modal-add-item">
        <div class="form-container">
            <form autocomplete="off">
                <button onclick="document.querySelector('.form-container').style.display = 'none'" style="float: right; font-size: 18px; padding: 5px; background: none; border: none;">&times;</button><br>
                <label for="description-add">Description:</label>
                <input id="description-add"><br>
    
                <label for="store-add">Store:</label>
                <select id="store-add">
                    <option>Select Store</option>
                    <option>Zara</option>
                    <option>H&M</option>
                    <option>Calzedonia</option>
                    <option>Media Markt</option>
                    <option>Media Expert</option>
                    <option>Ikea</option>
                    <option>Leroy Merlin</option>
                </select><br>
    
                <label for="price-add">Price:</label>
                <input id="price-add"><br>
    
                <label for="website-add">Website:</label>
                <input id="website-add"><br>
    
                <label for="category-add">Category:</label>
                <select id="category-add">
                    <option>Select Category</option>
                    <option>Clothes</option>
                    <option>Home</option>
                    <option>Electronics</option>
                </select><br>
    
                <label for="previewImage-add">Preview Image:</label>
                <input id="previewImage-add"><br>
    
                <label for="importance-add">Importance:</label>
                <select id="importance-add">
                    <option>Select Importance</option>
                    <option>Low</option>
                    <option>Medium</option>
                    <option>High</option>
                </select><br>
    
                <input type="button" onclick="addShoppingItem()" value="Add Item" style="float: right;">
            </form>
        </div>
    </div>

    <div class="modal" id="modal-edit-item">
        <div class="form-container">
            <form autocomplete="off">
                <button onclick="document.querySelector('.form-container').style.display = 'none'" style="float: right; font-size: 18px; padding: 5px; background: none; border: none;">&times;</button><br>
                <label for="description-edit">Description:</label>
                <input id="description-edit"><br>
    
                <label for="store-edit">Store:</label>
                <select id="store-edit">
                    <option>Select Store</option>
                    <option>Zara</option>
                    <option>H&M</option>
                    <option>Calzedonia</option>
                    <option>Media Markt</option>
                    <option>Media Expert</option>
                    <option>Ikea</option>
                    <option>Leroy Merlin</option>
                </select><br>
    
                <label for="price-edit">Price:</label>
                <input id="price-edit"><br>
    
                <label for="website-edit">Website:</label>
                <input id="website-edit"><br>
    
                <label for="category-edit">Category:</label>
                <select id="category-edit">
                    <option>Select Category</option>
                    <option>Clothes</option>
                    <option>Home</option>
                    <option>Electronics</option>
                </select><br>
    
                <label for="previewImage-edit">Preview Image:</label>
                <input id="previewImage-edit"><br>
    
                <label for="importance-edit">Importance:</label>
                <select id="importance-edit">
                    <option>Select Importance</option>
                    <option>Low</option>
                    <option>Medium</option>
                    <option>High</option>
                </select><br>
    
                <input type="button" id="button-edit" value="Edit Item" style="float: right;">
            </form>
        </div>
    </div>

    <div>
        <h3 style="text-align: center;">Your Budget: <input id="budget" size="5" value="2000"> zł</h3>
        <h3 style="text-align: center;">Total Cost: <span id="totalCost"></span></h3>
    </div>

    <div class="container">
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Description</th>
                        <th>Store</th>
                        <th>Price</th>
                        <th>Category</th>
                        <th>Website</th>
                        <th>Preview</th>
                        <th>Importance</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- create body using script -->
                </tbody>
            </table>
        </div>
        
        <div class="image-container">
            <!-- <img id="preview" src="" alt="Select Item to Preview" style="height: 300px; width: auto; margin-right: 200px;"> -->
            <img id="preview" src="" alt="Select Item to Preview">
        </div>         
    </div>

    <script>

        let shoppingItems = JSON.parse(window.localStorage.getItem("shoppingItems")) || []

        document.getElementById("budget").addEventListener("input", totalCost)

        function totalCost() {
            let totalCost = 0
            for (let index = 0; index < shoppingItems.length; index++) {
                let shoppingItem = shoppingItems[index]
                let price = shoppingItem.price
                totalCost += price
            }

            let budget = document.getElementById("budget").value

            if (totalCost < budget) {
                document.getElementById("totalCost").textContent = `${totalCost.toFixed(2)} zł`
                document.getElementById("totalCost").style.color = "green"
            } else {
                document.getElementById("totalCost").textContent = `${totalCost.toFixed(2)} zł (budget exceeded by ${(totalCost - budget).toFixed(2)} zł!)`
                document.getElementById("totalCost").style.color = "red"
            }

        }

        function createRows() {
            const tableBody = document.getElementById("tableBody")

            tableBody.innerHTML = ""
        
            let shoppingItems = JSON.parse(window.localStorage.getItem("shoppingItems"))
            if (!shoppingItems) {
                return
            } 

            for (let index = 0; index < shoppingItems.length; index++) {
                const row = document.createElement("tr")
                let shoppingItem = shoppingItems[index]

                row.id = index
                row.innerHTML = `<td>${shoppingItem.description}</td>
                                <td>${shoppingItem.store}</td>
                                <td>${shoppingItem.price.toFixed(2)} zł</td>
                                <td>${shoppingItem.category}</td>
                                <td><a href=${shoppingItem.website} target="_blank">&#128279;</a></td>
                                <td><button onclick='document.getElementById("preview").src = "${shoppingItem.previewImage}"' style="background: none; border: none; cursor: pointer;">&#128269;</button></td>
                                <td>${shoppingItem.importance}</td>
                                <td><button onclick="populateForm(${index})">Edit</button></td>
                                <td><button onclick="deleteRow(${index})">&times;</button></td>
                                `
                tableBody.appendChild(row)
            }

            totalCost()
        }

        function addShoppingItem() {
            let shoppingItem = {}

            shoppingItem.description = document.getElementById("description-add").value
            shoppingItem.store = document.getElementById("store-add").value
            shoppingItem.price = Number(document.getElementById("price-add").value)
            shoppingItem.category = document.getElementById("category-add").value
            shoppingItem.website = document.getElementById("website-add").value
            shoppingItem.previewImage = document.getElementById("previewImage-add").value
            shoppingItem.importance = document.getElementById("importance-add").value

            shoppingItems.push(shoppingItem)
            window.localStorage.setItem("shoppingItems", JSON.stringify(shoppingItems))
            createRows() // Refresh the table

            document.getElementById("description-add").value = null
            document.getElementById("store-add").value = "Select Store"
            document.getElementById("price-add").value = null
            document.getElementById("category-add").value = "Select Category"
            document.getElementById("website-add").value = null
            document.getElementById("previewImage-add").value = null
            document.getElementById("importance-add").value = "Select Importance"
        } 

        function clearStorage() {
            window.localStorage.clear()
            shoppingItems = []
            createRows()
        }

        function deleteRow(index) {
            shoppingItems.splice(index, 1)
            window.localStorage.setItem("shoppingItems", JSON.stringify(shoppingItems))
            createRows() // Refresh the table
        }

        function populateForm(index) {
            let shoppingItem = shoppingItems[index]

            document.getElementById("modal-edit-item").style.display = "flex"

            document.getElementById("description-edit").value = shoppingItem.description
            document.getElementById("store-edit").value = shoppingItem.store
            document.getElementById("price-edit").value = shoppingItem.price
            document.getElementById("category-edit").value = shoppingItem.category
            document.getElementById("website-edit").value = shoppingItem.website
            document.getElementById("previewImage-edit").value = shoppingItem.previewImage
            document.getElementById("importance-edit").value = shoppingItem.importance

            const button = document.getElementById("button-edit")
            button.addEventListener("click", function (e) {editRow(e, index)})
        }

        function editRow(e, index) {
            let shoppingItem = {}

            shoppingItem.description = document.getElementById("description-edit").value
            shoppingItem.store = document.getElementById("store-edit").value
            shoppingItem.price = Number(document.getElementById("price-edit").value)
            shoppingItem.category = document.getElementById("category-edit").value
            shoppingItem.website = document.getElementById("website-edit").value
            shoppingItem.previewImage = document.getElementById("previewImage-edit").value
            shoppingItem.importance = document.getElementById("importance-edit").value

            shoppingItems.splice(index, 1, shoppingItem) // Delete and insert at the same index
            window.localStorage.setItem("shoppingItems", JSON.stringify(shoppingItems))
            createRows() // Refresh the table
        }

    </script> 
</body>
</html>